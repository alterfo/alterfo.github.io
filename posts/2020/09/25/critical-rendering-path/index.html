<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Critical Rendering Path | Блог</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Critical Rendering Path это последовательность шагов по превращению браузером HTML, CSS и JavaScript в пиксели на экране.

Итак, браузер получает на обработку HTML-файл. Парсер проходит его байт за ба ...">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.5474d5c3.css" as="style"><link rel="preload" href="/assets/js/app.9a3be13b.js" as="script"><link rel="preload" href="/assets/js/6.6d8d87b4.js" as="script"><link rel="preload" href="/assets/js/35.cdfe83ff.js" as="script"><link rel="prefetch" href="/assets/js/1.22e13cfc.js"><link rel="prefetch" href="/assets/js/10.3067cb1e.js"><link rel="prefetch" href="/assets/js/11.a92f93a9.js"><link rel="prefetch" href="/assets/js/12.dc46fbef.js"><link rel="prefetch" href="/assets/js/13.fcd4802b.js"><link rel="prefetch" href="/assets/js/14.44876c2d.js"><link rel="prefetch" href="/assets/js/15.7937b6ea.js"><link rel="prefetch" href="/assets/js/16.3281a144.js"><link rel="prefetch" href="/assets/js/17.045ae130.js"><link rel="prefetch" href="/assets/js/18.42f27b60.js"><link rel="prefetch" href="/assets/js/19.ac11e6eb.js"><link rel="prefetch" href="/assets/js/2.54b37a65.js"><link rel="prefetch" href="/assets/js/20.21e56f7f.js"><link rel="prefetch" href="/assets/js/21.542083ec.js"><link rel="prefetch" href="/assets/js/22.ff78fbfc.js"><link rel="prefetch" href="/assets/js/23.1dd2f47b.js"><link rel="prefetch" href="/assets/js/24.82dbf54e.js"><link rel="prefetch" href="/assets/js/25.5cfcbf68.js"><link rel="prefetch" href="/assets/js/26.4d499b05.js"><link rel="prefetch" href="/assets/js/27.24c878f1.js"><link rel="prefetch" href="/assets/js/28.86942fc4.js"><link rel="prefetch" href="/assets/js/29.6ef0b457.js"><link rel="prefetch" href="/assets/js/3.d20b0515.js"><link rel="prefetch" href="/assets/js/30.ff6b6200.js"><link rel="prefetch" href="/assets/js/31.72326215.js"><link rel="prefetch" href="/assets/js/32.cecd5f8f.js"><link rel="prefetch" href="/assets/js/33.ac33a1d6.js"><link rel="prefetch" href="/assets/js/34.24869d83.js"><link rel="prefetch" href="/assets/js/36.7843586b.js"><link rel="prefetch" href="/assets/js/37.1ddffe8e.js"><link rel="prefetch" href="/assets/js/38.bcf76a33.js"><link rel="prefetch" href="/assets/js/39.a5a1e4fd.js"><link rel="prefetch" href="/assets/js/4.7346b154.js"><link rel="prefetch" href="/assets/js/40.2242aa28.js"><link rel="prefetch" href="/assets/js/41.de1ec231.js"><link rel="prefetch" href="/assets/js/42.8abaca81.js"><link rel="prefetch" href="/assets/js/43.6d8d44d2.js"><link rel="prefetch" href="/assets/js/44.1943569e.js"><link rel="prefetch" href="/assets/js/45.8eaa1d6b.js"><link rel="prefetch" href="/assets/js/46.a44f32b7.js"><link rel="prefetch" href="/assets/js/47.d213621f.js"><link rel="prefetch" href="/assets/js/48.27cb4b2f.js"><link rel="prefetch" href="/assets/js/49.9dad2ef5.js"><link rel="prefetch" href="/assets/js/5.b0d41900.js"><link rel="prefetch" href="/assets/js/50.94705a8f.js"><link rel="prefetch" href="/assets/js/51.1210696b.js"><link rel="prefetch" href="/assets/js/52.e26258dd.js"><link rel="prefetch" href="/assets/js/53.4ba53d6f.js"><link rel="prefetch" href="/assets/js/54.945f0a92.js"><link rel="prefetch" href="/assets/js/7.d1eea65e.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.9e57b552.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5474d5c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><main data-v-4d3dfa27><header id="large-header" class="site-header" data-v-4d3dfa27><canvas id="canvas"></canvas> <div class="animation-toggler top-2"><a href="javascript:void(0)">Включить анимацию!</a></div> <div class="page-title" style="opacity:1;">Critical Rendering Path</div></header> <div class="content-wrapper" data-v-4d3dfa27><main data-v-4d3dfa27><article><div class="content__default"><p>Critical Rendering Path это последовательность шагов по превращению браузером HTML, CSS и JavaScript в пиксели на экране.</p> <p>Итак, браузер получает на обработку HTML-файл. Парсер проходит его байт за байтом и вычленяет токены (самые главные - startTag, endTag), потом из набора токенов строятся ноды, а из иерархии нод получается Document Object Model (DOM) на основе информации о последовательности токенов. В DOM содержится весь контент страницы.</p> <p>Когда парсер находит токены запросов внешних ресурсов (стилей, картинок, скриптов), он их запрашивает, но от 4 до 7 за раз в зависимости от браузера. Некоторые запросы блокируют парсинг, некоторые могут идти в параллели.</p> <p>Когда парсер видит токен стилей, он начинает строить CSS Object Model (CSSOM). Оно строится очень быстро, поэтому оптимизация CSS-селекторов не даёт большого прироста к производительности, а минификация и отложенный запрос второстепенных стилей - даёт. Когда DOM и CSSOM готовы, начинается создание Render Tree.</p> <p>Render Tree содержит в себе весь контент и его стилизацию. Кроме явно скрытых (display:none) элементов.</p> <p>Эти три фазы, как правило,происходят один раз, но возможны ситуации когда свежезагруженный скрипт основательно меняет DOM (размеры элементов, отступы), тогда этот процесс происходит заново.</p> <p>На основе Render Tree строится Layout - расположение элементов друг относительно друга и размеры блоков на основе их содержимого. Нужно помнить, что изменение размеров окна браузера, поворот смартфона, а и иногда и обычный запрос из скрипта расстояния между элементами может привести к пересчёту всего Layout. Чем больше DOM, тем больше занимает время пересчёт Layout (reflow). В это время страница не может реагировать на действия пользователя. Желательно что бы reflow занимал максимум 10 миллисекунд чтобы добиться 60 кадров в секунду.</p> <p>Следующий шаг - Paint. Обычно он не доставляет хлопот в оптимизации, он просто растеризует (превращает в пиксели с помощью GPU) то, что насчиталось в Layout. Paint происходит в несколько слоёв в зависимости от позиционирования элементов. Проблемы с ним бывают при работе со сложной анимацией в canvas, они решаются отрисовкой в памяти, &quot;за экраном&quot; с помощью OffScreenCanvas или WebWorker-ов.</p> <p>Поскольку отрисовка многослойная, мы получаем возможность двигать элементы не вызывая Paint снова. Пока только два стиля - opacity и transition - работают на этом этапе. Указать парсеру что элемент будет двигаться можно заранее с помощью</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token property">will-change</span><span class="token punctuation">:</span> transform<span class="token punctuation">;</span>
</code></pre></div><p>но не нужно делать этого повсеместно чтобы не нагружать GPU.</p> <p>Поскольку браузер - основная платформа веб-разработчиков, непонимание вышеописанного процесса ведёт к созданию неотзывчивых сайтов.</p> <p>Секунды задержки в интернет-магазинах приводят к миллионам недополученной прибыли. А из-за отсутствия при старте проекта требований к производительности, веб-приложение для гос-служащих с 15Мб скриптов на Камчатке грузится 38 минут.</p> <p>Источники:</p> <p>Личный опыт</p> <p>https://developers.google.com/web/fundamentals/performance/rendering</p> <p>https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path</p></div></article></main></div> <footer class="footer" data-v-6c022017 data-v-4d3dfa27><div class="footer-right-wrap" data-v-6c022017><p data-v-6c022017>Персональный блог человека, разработчика и музыканта.</p></div></footer></main><div class="global-ui"></div></div>
    <script src="/assets/js/app.9a3be13b.js" defer></script><script src="/assets/js/6.6d8d87b4.js" defer></script><script src="/assets/js/35.cdfe83ff.js" defer></script>
  </body>
</html>
