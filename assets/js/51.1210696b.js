(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{391:function(v,_,a){"use strict";a.r(_);var t=a(4),e=Object(t.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v('Это третья статья в цикле "Выбор стека технологий".')]),v._v(" "),_("p",[_("a",{attrs:{href:"/stack-1"}},[v._v("1. Выбор стека технологий (введение и кейсы)")]),v._v(" "),_("a",{attrs:{href:"/stack-2"}},[v._v("1. Выбор стека технологий (доступность и поддерживаемость)")])]),v._v(" "),_("p",[v._v("В первой статье мы определили содержание стека технологий. Это:")]),v._v(" "),_("ul",[_("li",[v._v("хранилище данных")]),v._v(" "),_("li",[v._v("бэкенд-фреймворк")]),v._v(" "),_("li",[v._v("фронтенд-фреймворк")]),v._v(" "),_("li",[v._v("системы виртуализации/контейнеризации")]),v._v(" "),_("li",[v._v("API")]),v._v(" "),_("li",[v._v("DevOps (IaC, мониторинг, логгирование), например, ELK (Elasticsearch, Logstash, Kibana)")])]),v._v(" "),_("p",[v._v("Во второй статье мы рассмотрели вопрос выбора стека с точки зрения атрибутов качества - доступность и поддерживаемость")]),v._v(" "),_("p",[v._v("В этой статье мы посмотрим на вопрос выбора стека ещё шире, глубже и конкретнее.")]),v._v(" "),_("blockquote",[_("p",[v._v("Critical thinking is the analysis of available facts, evidence, observations, and arguments to form a judgment.")]),v._v(" "),_("p",[v._v('Edward M. Glaser. "'),_("a",{attrs:{href:"https://www.criticalthinking.org/pages/defining-critical-thinking/766",target:"_blank",rel:"noopener noreferrer"}},[v._v("Defining Critical Thinking"),_("OutboundLink")],1),v._v('"')])]),v._v(" "),_("blockquote",[_("p",[v._v("Критическое мышление — способность человека ставить под сомнение поступающую информацию, включая собственные убеждения.")]),v._v(" "),_("p",[v._v("Википедия")])]),v._v(" "),_("p",[v._v("На что не стоит опираться при выборе стека:")]),v._v(" "),_("ul",[_("li",[v._v("Личные предпочтения")]),v._v(" "),_("li",[v._v("Хайп")]),v._v(" "),_("li",[v._v("Советы коллег из других компаний")]),v._v(" "),_("li",[v._v("Звездочки на Github-е")]),v._v(" "),_("li",[v._v("Опросы на Stackoverflow")])]),v._v(" "),_("p",[v._v("На что стоит делать упор:")]),v._v(" "),_("ul",[_("li",[v._v("Личный опыт успешных проектов")]),v._v(" "),_("li",[v._v("Доказанный опыт успешных проектов других компаний")]),v._v(" "),_("li",[v._v("Простоту и удобство использования")]),v._v(" "),_("li",[v._v("Наличие прототипов, реализующих задуманное на конкретной технологии")]),v._v(" "),_("li",[v._v("Отношение потенциальной пользы от внедрения к трудопотерям на внедрение")])]),v._v(" "),_("p",[v._v("Список вопросов, на которые стоит ответить при выборе любого решения, не только стека:")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("Как долго эта технология будет жива и пользоваться спросом?")]),v._v(" Flash, Pascal, VHS - популярные в прошлом, но забытые сейчас. Нужно брать технологии, у которых впереди в запасе как минимум 10 лет развития.")]),v._v(" "),_("li",[_("strong",[v._v("Легко ли обслуживать эту технологию?")]),v._v(' "Используя популярный тулсет вы с легкостью найдете специалиста" именно этим руководствовались миллионы проектов которые взяли React в качестве фронтенд-фреймворка. В итоге множество проектов завязли в некачественном коде из-за отсутствия архитектуры. Если вам нужно быстро выйти на рынок, проще всего взять PHP и Vue. Но на долгой дистанции с ними будет много мучений.')]),v._v(" "),_("li",[_("strong",[v._v("Какие обременения и накладные расходы у этой технологии?")]),v._v(" О выгодах мы задумываемся автоматически. Они ослепляют. Каждая новая технология это +1 человек к команде. Typescript - кто-то должен писать типы, UI Material - кто-то должен читать документацию, Docker - отдельный человек для написания helm-charts и тд.")]),v._v(" "),_("li",[_("strong",[v._v("Если это миграция - возможен ли откат, какова цена восстановления в случае неудачи?")])]),v._v(" "),_("li",[_("strong",[v._v("Если это внедрение нового - какова стоимость внедрения и сроки окупаемости?")])])]),v._v(" "),_("p",[v._v("Помимо всего прочего, важна экспертная оценка реализации проекта. Желательно иметь подробный ресурсный план для каждой технологии, написанный признанным экспертом.")]),v._v(" "),_("p",[v._v("Может оказаться, что реализация на Java и React займет год и 100 миллионов, но на Go и Angular - полгода и 20 миллионов. Выбор будет очевиден.")]),v._v(" "),_("h2",{attrs:{id:"пример-переусложнения"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#пример-переусложнения"}},[v._v("#")]),v._v(" Пример переусложнения")]),v._v(" "),_("p",[v._v("В этой выдуманной истории огромное количество скрытой иронии, прошу прощения.")]),v._v(" "),_("p",[v._v("Итак, представьте, у генерального директора Андрея появилась идея на миллиард, и даже предварительные договоренности о продажах. Он подходит к своему зятю-программисту Алексею и говорит - нужно сделать проект, поможешь?")]),v._v(" "),_("p",[v._v("Андрей назначает Алексея CTO (станция техобслуживания) и ждет первых результатов.")]),v._v(" "),_("p",[v._v("Алексей, не будучи дураком, начинает мыслить глобально, как настоящий профессионал.")]),v._v(" "),_("p",[v._v("Он начинает с Frontend-а. Язык - без вариантов - JavaScript. Точнее, его типизированная ипостась - Typescript. Из статей в интернете он узнает что у Angular очень высокий порог вхождения, Vue имеет слабую поддержку одним человеком, а jQuery уже устарел и выбирает React. Ведь на рынке огромная толпа разработчиков на React и астрономическое количество готовых компонентов для него. К тому же React не ограничивает архитектуру, гибкость инструмента способствует быстрой разработке.")]),v._v(" "),_("p",[v._v("Также он узнает что Bootstrap уже не моден и в качестве компонентной библиотеки выбирает Material-UI. А в качестве CSS-фреймворка Tailwind.")]),v._v(" "),_("p",[v._v("Также, для фронтенда ему пригодятся Webpack, icomoon и сотня-другая компонентов для реализации задуманного, включая websocket и canvas.")]),v._v(" "),_("p",[v._v("Ах да, он чуть не забыл про State-manager, коих уже десятки, он выбирает самый популярный Redux, ведь, чем больше boilerplate-кода, тем стабильнее и надежнее приложение.")]),v._v(" "),_("p",[v._v("Итак, на фронтенде - React, Redux, Material-UI, Tailwind, Webpack и много всего остального.")]),v._v(" "),_("p",[v._v("Бэкенд - тут Алексей решил не переусложнять, а оставить один язык для всего приложения и на сервере будет запущено приложение на Node.js. Повыбирав из фреймворков (Next.js, Nuxt.js, etc.js...), он решил взять то, что не имеет строгой привязки к фреймворку - Nest.js.")]),v._v(" "),_("p",[v._v("База данных - конечно MongoDB, ведь в интернете написано что она очень быстрая и гибкая. Но, на всякий случай, будем использовать ее как реляционную, все сущности будут связаны и лежать в отдельных коллекциях. Рядом будет in-memory cache Redis на случай большой нагрузки.")]),v._v(" "),_("p",[v._v("В качестве API Алексей решил сделать прямое соединение через Websocket. Это быстро, модно и просто.")]),v._v(" "),_("p",[v._v("Подумав ещё, Алексей решил сразу создать пайплайны CI/CD, и сразу запускать Docker-контейнеры в облако с помощью helm-чартов - в Kubernetes кластер, чтобы иметь возможность горизонтально масштабировать приложение автоматически.")]),v._v(" "),_("p",[v._v("А чтобы контейнеров было побольше - для пущей модульности - сразу решил разделить приложение на микросервисы и положить в разные репозитории, общение организовать через Kafka, а базу данных - реплицировать на три ноды, так точно будет работать быстрее.")]),v._v(" "),_("p",[v._v("Прошло несколько лет, продукт наконец вышел, рос медленно, но верно и продажи поднялись - продукт получил популярность, даже с такими высокими ценами. Алексей решает набрать команду и нанимает 7 фулл-стэк разработчиков. К этому моменту и в последствии, tailwindcss и material-ui использованы в 10% кода, React-компоненты встречаются и в виде классов, и в функциональном стиле со множеством перегруженных кастомных хуков.")]),v._v(" "),_("p",[v._v("А тем временем приложение начинает падать по три раза в день от наплыва пользователей - база данных съедает всю память на самой большой виртуальной машине в облаке потому что деплой в Kubernetes так и не смогли настроить ни подрядчики ни весь отдел разработки, хотя пытались по очереди все. Kafka тоже не поднялась.")]),v._v(" "),_("p",[v._v("Также возникают проблемы с уведомлениями - письма не доходят - падают в спам, заказчики не получают вовремя отчеты, а работа идет все медленнее и медленнее из-за количества багов ввиду излишней гибкости фронтенда.")]),v._v(" "),_("p",[v._v("Поскольку CTO не разбирался в серверах и у него никогда не было больших проектов, место на диске съели логи, продуктовый сервер был настроен абы как, а доступ к нему был у половины разработчиков в любое время без надзора. Разделения сред тоже не продумали, тестовый сервер оккупировал менеджмент для демонстраций заказчику, ломать его было нельзя, данные мало были похожи на реальные.")]),v._v(" "),_("p",[v._v("Наш CTO понимает что пора - пора осуществить задуманное - переехать с MongoDB на RDBMS, например, PostgreSQL, но количество написанных без ORM агрегаций, которыми так славится MongoDB, выглядело неподъемным. Redis не помогал, а больше мешал. Типы были перегруженными, а конвертация данных - повсеместной. В проекте насчитывались тысячи вызовов map и reduce.")]),v._v(" "),_("p",[v._v("Плюс, заказчики стали настаивать на том, чтобы приложение работало оффлайн (эту функцию откладывали до последнего, как слишком простую, были задачи поинтереснее, с canvas-ом). И тут выясняется, что нужно загрузить несколько гигабайт информации на устройство пользователя. А при каждом обновлении приложения эти данные стирать, потому что схема изменилась, то есть, писать миграции для State manager-а.")]),v._v(" "),_("p",[v._v("Генеральный директор, видя что приложение падает под напором, предлагает самым крупным заказчикам беспрецендентный шаг - ради их же безопасности, компания будет устанавливать приложение на сервера заказчика. Первая установка прошла успешно, вторая тоже, но автоматизировать процесс установки не получается - можно только вручную и особо обученным сотрудником - человеком, разбирающемся в приложении, интеграциях и unix-серверах. Такой стоит недешево.")]),v._v(" "),_("p",[v._v("В общем и целом, оверинжиниринг во всей красе - 12 окружений которые нужно обновлять только вручную и только по выходным, плюс множество технологий, которые сильно усложняют общую картину, хотя, казалось бы, призваны решать проблемы.")]),v._v(" "),_("p",[v._v("Цена упрощения такого проекта - примерно 10 миллионов рублей. Это выделенная команда для миграции из 6 человек на год работы.")]),v._v(" "),_("p",[v._v("Несмотря на то, что проект успел заработать в несколько раз больше - такой огромный технический долг его может потопить.")]),v._v(" "),_("h2",{attrs:{id:"пример-упрощения"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#пример-упрощения"}},[v._v("#")]),v._v(" Пример упрощения")]),v._v(" "),_("p",[v._v("В целом, стэк был выбран разумно, но к переусложнению привели другие факторы. Время разобраться.")]),v._v(" "),_("p",[v._v("Давайте сначала выпишем ошибки, которые были допущены выше:")]),v._v(" "),_("ol",[_("li",[v._v("Использование MongoDB как реляционной базы данных привело к дорогим проблемам производительности")]),v._v(" "),_("li",[v._v("Чрезмерная преждевременная оптимизация и решение вымышленных проблем масштабирования привело к потере времени на настройку")]),v._v(" "),_("li",[v._v("Назначение CTO малокомпетентного и неопытного человека")])]),v._v(" "),_("p",[v._v("Исходя из этого, фундамент проекта стоило заложить так:")]),v._v(" "),_("ul",[_("li",[v._v("Использовать MongoDB в качестве хранилища, но как NoSQL - так будет проще работать с данными - агрегации все равно запускаются на JavaScript, также будет проще переходить на реляционную базу - запросы будут проще, да и на несколько баз разделить проще")]),v._v(" "),_("li",[v._v("Ввести правило оценивать трудозатраты и потенциальную выгоду от реализации фич, таким образом ни функциональность, ни архитектура решения не будут страдать от жажды скорой наживы")]),v._v(" "),_("li",[v._v("Начать с самого простого - с монолита, так как очень редко встречаются настолько огромные проекты чтобы вводить микросервисную архитектуру")]),v._v(" "),_("li",[v._v("Поставки приложения - в виде образа виртуальной машины, который достаточно просто развернуть в среде заказчика, руками самого заказчика")]),v._v(" "),_("li",[v._v("Описать архитектуру проекта в виде 4D и менять по мере необходимости")]),v._v(" "),_("li",[v._v("На ранних стадиях ввести мониторинг систем, установить ELK стэк и настроить режим логгирования, бэкапа, управления инцидентами")]),v._v(" "),_("li",[v._v('Следовать принципу "проще - лучше", причем, "так быстрее" - почти всегда плохо и приводит к сложностям')])])])}),[],!1,null,null,null);_.default=e.exports}}]);